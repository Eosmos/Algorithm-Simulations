<div class="decision-tree-container">
    <div class="heading-container">
      <h1>Interactive Decision Tree Simulation</h1>
      <p class="lead">Learn how decision trees work through this interactive visualization</p>
    </div>
    
    <div class="controls-container">
      <div class="control-panel">
        <div class="simulation-group">
          <h4>Simulation Controls</h4>
          <div class="simulation-controls">
            <div class="btn-group">
              <button class="btn" [disabled]="isAutoPlaying" (click)="prevStep()">
                <i class="fas fa-step-backward"></i> Prev
              </button>
              <button class="btn play-btn" *ngIf="!isAutoPlaying" (click)="playSimulation()">
                <i class="fas fa-play"></i> Play
              </button>
              <button class="btn pause-btn" *ngIf="isAutoPlaying" (click)="stopSimulation()">
                <i class="fas fa-pause"></i> Pause
              </button>
              <button class="btn" [disabled]="isAutoPlaying" (click)="nextStep()">
                <i class="fas fa-step-forward"></i> Next
              </button>
            </div>
            
            <div class="speed-control">
              <label>Animation Speed: {{ animationSpeed }}ms</label>
              <input type="range" min="500" max="2000" step="100" [value]="animationSpeed" 
                     #speedInput (input)="onSpeedChange(+speedInput.value)">
            </div>
          </div>
        </div>
        
        <div class="features-group">
          <h4>Visualization Settings</h4>
          <div class="settings-controls">
            <div class="metric-selector">
              <label>Impurity Metric:</label>
              <div class="btn-group">
                <button class="btn" [class.active]="metricType === 'gini'" (click)="onMetricChange('gini')">Gini</button>
                <button class="btn" [class.active]="metricType === 'entropy'" (click)="onMetricChange('entropy')">Entropy</button>
                <button class="btn" [class.active]="metricType === 'mse'" (click)="onMetricChange('mse')">MSE</button>
              </div>
            </div>
            
            <div class="feature-selector">
              <label>Primary Feature:</label>
              <div class="feature-buttons">
                <button 
                  *ngFor="let feature of availableFeatures" 
                  class="feature-btn" 
                  [class.active]="feature === selectedFeature"
                  (click)="onFeatureChange(feature)">
                  {{ feature }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress" [style.width.%]="buildProgress"></div>
        </div>
        <div class="step-description">
          <span class="step-number">Step {{ currentStepNumber }} of {{ totalSteps }}</span>
          <p>{{ stepDescription }}</p>
        </div>
      </div>
    </div>
    
    <div class="visualization-container">
      <div class="tree-view">
        <h3>Decision Tree Structure</h3>
        <div #treeContainer class="tree-container"></div>
      </div>
      
      <div class="data-view">
        <h3>Data Visualization</h3>
        <div #dataContainer class="data-container"></div>
        
        <div class="legend">
          <div class="legend-item">
            <div class="color-box yes"></div>
            <span>Yes (Class 1)</span>
          </div>
          <div class="legend-item">
            <div class="color-box no"></div>
            <span>No (Class 0)</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="explanation-container">
      <h3>Decision Tree Explained</h3>
      
      <div class="accordion">
        <div class="accordion-item">
          <div class="accordion-header" (click)="accordionToggle($event)">
            <h4>What Are Decision Trees?</h4>
          </div>
          <div class="accordion-content">
            <p>Decision Trees are a machine learning algorithm used for both classification (e.g., spam vs. not spam) and regression (e.g., predicting house prices). They represent decisions in a tree-like structure:</p>
            <ul>
              <li><strong>Internal nodes:</strong> Represent features (e.g., "age" or "income").</li>
              <li><strong>Branches:</strong> Represent decision rules (e.g., "age < 30").</li>
              <li><strong>Leaf nodes:</strong> Represent outcomes (e.g., a class label like "yes" or a numeric value like "50").</li>
            </ul>
          </div>
        </div>
        
        <div class="accordion-item">
          <div class="accordion-header" (click)="accordionToggle($event)">
            <h4>How Do Decision Trees Work?</h4>
          </div>
          <div class="accordion-content">
            <p>Decision Trees work by recursively splitting the dataset into subsets based on feature values. At each step, they choose the feature and threshold that best separates the data—maximizing information gain for classification or variance reduction for regression.</p>
            <p>The process continues until the subsets are "pure" (all instances in a subset belong to the same class or have similar values) or a stopping rule is triggered.</p>
          </div>
        </div>
        
        <div class="accordion-item">
          <div class="accordion-header" (click)="accordionToggle($event)">
            <h4>Splitting Criteria</h4>
          </div>
          <div class="accordion-content">
            <h5>For Classification:</h5>
            <ul>
              <li><strong>Gini Impurity:</strong> Measures impurity; lower is better.<br>Formula: Gini = 1 - ∑(p_i²), where p_i is the proportion of class i.</li>
              <li><strong>Entropy:</strong> Measures uncertainty; reduced via Information Gain.<br>Formula: Entropy = -∑(p_i × log₂(p_i)).</li>
            </ul>
            
            <h5>For Regression:</h5>
            <ul>
              <li><strong>Mean Squared Error (MSE):</strong> Measures variance; lower is better.<br>Formula: MSE = (1/n) × ∑(y_i - ȳ)², where ȳ is the node's mean value.</li>
            </ul>
          </div>
        </div>
        
        <div class="accordion-item">
          <div class="accordion-header" (click)="accordionToggle($event)">
            <h4>Strengths & Weaknesses</h4>
          </div>
          <div class="accordion-content">
            <h5>Strengths:</h5>
            <ul>
              <li><strong>Easy to Understand:</strong> The tree structure is visual and intuitive, even for non-experts.</li>
              <li><strong>Versatile:</strong> Works with numerical and categorical data without much preprocessing.</li>
              <li><strong>No Data Assumptions:</strong> Doesn't require a specific data distribution.</li>
              <li><strong>Feature Insights:</strong> Shows which features matter most for predictions.</li>
            </ul>
            
            <h5>Weaknesses:</h5>
            <ul>
              <li><strong>Overfitting:</strong> Can grow too complex, fitting noise in the training data.</li>
              <li><strong>Instability:</strong> Small data changes can drastically alter the tree.</li>
              <li><strong>Bias:</strong> May favor features with many unique values, skewing splits.</li>
            </ul>
          </div>
        </div>
        
        <div class="accordion-item">
          <div class="accordion-header" (click)="accordionToggle($event)">
            <h4>Real-World Applications</h4>
          </div>
          <div class="accordion-content">
            <ul>
              <li><strong>Healthcare:</strong> Diagnosing diseases based on symptoms.</li>
              <li><strong>Finance:</strong> Predicting credit risk or detecting fraud.</li>
              <li><strong>Marketing:</strong> Segmenting customers or predicting churn.</li>
              <li><strong>Ecology:</strong> Classifying species by environmental traits.</li>
            </ul>
          </div>
        </div>
        
        <div class="accordion-item">
          <div class="accordion-header" (click)="accordionToggle($event)">
            <h4>Advanced Concepts</h4>
          </div>
          <div class="accordion-content">
            <h5>Pruning</h5>
            <p>Pruning is a technique used to reduce overfitting in decision trees. It involves removing branches that have little predictive power:</p>
            <ul>
              <li><strong>Pre-pruning:</strong> Stop tree growth early using criteria like maximum depth.</li>
              <li><strong>Post-pruning:</strong> Build the full tree, then remove branches that don't improve performance on validation data.</li>
            </ul>
            
            <h5>Ensemble Methods</h5>
            <p>Decision trees are often used as base models in powerful ensemble techniques:</p>
            <ul>
              <li><strong>Random Forests:</strong> Build multiple trees using random subsets of data and features, then average their predictions.</li>
              <li><strong>Gradient Boosting:</strong> Build trees sequentially, with each one correcting errors made by previous trees.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>