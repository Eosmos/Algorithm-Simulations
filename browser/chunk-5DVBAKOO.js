import{B as T,d as Y,e as Z,i as M,j as P,k as O,q as j,r as _,w as F,x as J}from"./chunk-SKIYKJGI.js";import{k as X,o as U}from"./chunk-VTXOXBVL.js";import{Da as W,Ia as G,Oa as k,Qa as E,X as v,Xa as a,Y as y,Ya as i,Za as C,ab as D,db as S,eb as L,fa as B,gb as R,hb as V,ib as A,kb as n,lb as w,mb as H,nb as $,ua as x,za as K}from"./chunk-CS32D7W3.js";var et=["gridContainer"],it=["qValueChart"],nt=["rewardChart"],at=["tdErrorChart"];function rt(z,t){if(z&1){let r=D();a(0,"div",48)(1,"h3"),n(2,"Simulation Results"),i(),a(3,"textarea",49),n(4),i(),a(5,"button",50),S("click",function(){v(r);let o=L();return y(o.copyResultsToClipboard())}),a(6,"span",12),n(7,"\u{1F4CB}"),i(),n(8," Copy Results "),i()()}if(z&2){let r=L();x(4),w(r.simulationResults)}}var tt=class z{constructor(t){this.ngZone=t}gridContainer;qValueChart;rewardChart;tdErrorChart;gridSize=8;cellSize=60;grid=[];qTable={};learningRate=.1;discountFactor=.9;epsilon=.3;epsilonDecayRate=.99;minEpsilon=.01;agent={x:0,y:0,totalReward:0,episode:0,step:0,isExploring:!1};isRunning=!1;isAutoPlaying=!1;speed=300;timerId=null;episodeRewards=[];tdErrors=[];playbackSpeed=1;maxEpisodes=100;isSimulationComplete=!1;simulationResults="";svg;qValueSvg;rewardChartSvg;tdErrorChartSvg;agentElement;qValueArrows={};tooltipDiv;currentExplanation="Welcome to the Q-Learning Simulation. Press Play to start learning automatically, or use the Step button to move through the process manually.";ngOnInit(){this.initializeGrid(),this.initializeQTable()}ngAfterViewInit(){this.initializeVisualization(),this.initializeQValueVisualization(),this.initializeRewardChart(),this.initializeTDErrorChart(),this.createTooltip()}ngOnDestroy(){this.stopSimulation()}generateSimulationResults(){let t=this.episodeRewards.reduce((s,b)=>s+b,0)/this.episodeRewards.length,r=Math.max(...this.episodeRewards),e=Math.min(...this.episodeRewards),o=this.episodeRewards.slice(-10).reduce((s,b)=>s+b,0)/10,p=this.episodeRewards.filter(s=>s>0).length/this.maxEpisodes*100,g=this.tdErrors.slice(0,20).reduce((s,b)=>s+Math.abs(b),0)/20,c=this.tdErrors.slice(-20).reduce((s,b)=>s+Math.abs(b),0)/20,h=(g-c)/g*100,m=1/0;for(let s=0;s<this.episodeRewards.length;s++)if(this.episodeRewards[s]>0){let b=(100+this.episodeRewards[s])/99;m=Math.min(m,b)}let d=`Q-LEARNING SIMULATION RESULTS
`;d+=`==========================

`,d+=`Total Episodes: ${this.maxEpisodes}
`,d+=`Success Rate: ${p.toFixed(1)}%
`,d+=`Average Reward: ${t.toFixed(2)}
`,d+=`Best Episode Reward: ${r.toFixed(2)}
`,d+=`Worst Episode Reward: ${e.toFixed(2)}
`,d+=`Average Reward (last 10 episodes): ${o.toFixed(2)}

`,d+=`LEARNING METRICS
`,d+=`---------------
`,d+=`TD Error Reduction: ${h.toFixed(1)}%
`,d+=`Shortest Successful Path: ~${Math.ceil(m)} steps
`,d+=`Final Exploration Rate (\u03B5): ${this.epsilon.toFixed(4)}

`,d+=`Q-VALUES ANALYSIS
`,d+=`---------------
`;let f=[];for(let s in this.qTable){let b=this.qTable[s],N=["up","down","left","right"],I=N[0],Q=b[I];N.forEach(q=>{b[q]>Q&&(Q=b[q],I=q)}),Q>0&&f.push({stateKey:s,maxQValue:Q,bestAction:I})}f.sort((s,b)=>b.maxQValue-s.maxQValue);let u=f.slice(0,5);d+=`Top 5 Highest Q-Values:
`,u.forEach((s,b)=>{d+=`${b+1}. Position (${s.stateKey}) - Action: ${s.bestAction}, Value: ${s.maxQValue.toFixed(2)}
`}),d+=`
CONCLUSION
`,d+=`----------
`,p>80?d+=`The agent learned an effective policy, finding the optimal path to the goal in most episodes.
`:p>50?d+=`The agent developed a moderate policy, sometimes finding the goal but not always optimally.
`:d+=`The agent struggled to learn an effective policy for this environment.
`,d+=`
The learning process demonstrates key Q-learning principles:
`,d+=`- Exploration vs. exploitation balance
`,d+=`- Value propagation from rewards
`,d+=`- Temporal difference learning
`,d+=`- Policy convergence over time
`,this.simulationResults=d}copyResultsToClipboard(){let t=document.createElement("textarea");t.value=this.simulationResults,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),alert("Results copied to clipboard!")}initializeGrid(){this.grid=Array(this.gridSize).fill(null).map((t,r)=>Array(this.gridSize).fill(null).map((e,o)=>({x:r,y:o,type:"empty",reward:0}))),[{x:1,y:2},{x:2,y:2},{x:3,y:2},{x:4,y:4},{x:5,y:4},{x:6,y:4},{x:3,y:5},{x:3,y:6}].forEach(t=>{t.x<this.gridSize&&t.y<this.gridSize&&(this.grid[t.x][t.y].type="wall")}),this.grid[7][7].type="goal",this.grid[7][7].reward=100,[{x:2,y:5},{x:5,y:2},{x:6,y:6}].forEach(t=>{t.x<this.gridSize&&t.y<this.gridSize&&this.grid[t.x][t.y].type==="empty"&&(this.grid[t.x][t.y].type="pitfall",this.grid[t.x][t.y].reward=-50)});for(let t=0;t<this.gridSize;t++)for(let r=0;r<this.gridSize;r++)this.grid[t][r].type==="empty"&&(this.grid[t][r].reward=-1);this.resetAgent()}initializeQTable(){for(let t=0;t<this.gridSize;t++)for(let r=0;r<this.gridSize;r++)if(this.grid[t][r].type!=="wall"){let e=`${t},${r}`;this.qTable[e]={up:0,down:0,left:0,right:0}}}resetAgent(){this.agent.x=0,this.agent.y=0,this.agent.totalReward=0,this.agent.step=0,this.agent.isExploring=!1}getStateKey(t,r){return`${t},${r}`}getValidActions(t,r){let e=[];return r>0&&this.grid[t][r-1].type!=="wall"&&e.push("up"),r<this.gridSize-1&&this.grid[t][r+1].type!=="wall"&&e.push("down"),t>0&&this.grid[t-1][r].type!=="wall"&&e.push("left"),t<this.gridSize-1&&this.grid[t+1][r].type!=="wall"&&e.push("right"),e}chooseAction(t,r){let e=this.getStateKey(t,r),o=this.getValidActions(t,r);if(o.length===0)return console.error("No valid actions available at position",t,r),{action:"up",isExploring:!1};if(Math.random()<this.epsilon){let g=Math.floor(Math.random()*o.length);return{action:o[g],isExploring:!0}}let l=o[0],p=this.qTable[e][l];for(let g=1;g<o.length;g++){let c=o[g];this.qTable[e][c]>p&&(p=this.qTable[e][c],l=c)}return{action:l,isExploring:!1}}getNextState(t,r,e){let o=t,l=r;switch(e){case"up":r>0&&this.grid[t][r-1].type!=="wall"&&(l=r-1);break;case"down":r<this.gridSize-1&&this.grid[t][r+1].type!=="wall"&&(l=r+1);break;case"left":t>0&&this.grid[t-1][r].type!=="wall"&&(o=t-1);break;case"right":t<this.gridSize-1&&this.grid[t+1][r].type!=="wall"&&(o=t+1);break}return{nextX:o,nextY:l}}updateQValue(t,r,e,o,l,p){let g=this.getStateKey(t,r),c=this.getStateKey(o,l),h=-1/0;if(this.qTable[c]){let f=Object.values(this.qTable[c]);h=Math.max(...f)}else h=0;let d=p+this.discountFactor*h-this.qTable[g][e];return this.qTable[g][e]+=this.learningRate*d,d}isTerminalState(t,r){return this.grid[t][r].type==="goal"||this.grid[t][r].type==="pitfall"}decayEpsilon(){this.epsilon=Math.max(this.minEpsilon,this.epsilon*this.epsilonDecayRate)}step(){let{x:t,y:r}=this.agent,{action:e,isExploring:o}=this.chooseAction(t,r),{nextX:l,nextY:p}=this.getNextState(t,r,e),g=this.grid[l][p].reward,c=this.updateQValue(t,r,e,l,p,g);if(this.agent.x=l,this.agent.y=p,this.agent.totalReward+=g,this.agent.step++,this.agent.isExploring=o,this.agent.lastAction=e,this.agent.tdError=c,this.tdErrors.push(c),this.updateExplanation(e,o,l,p,g,c),this.isTerminalState(l,p)||this.agent.step>100){if(this.episodeRewards.push(this.agent.totalReward),this.agent.episode++,this.decayEpsilon(),this.agent.episode>=this.maxEpisodes){this.stopSimulation(),this.currentExplanation=`Simulation complete! Completed ${this.maxEpisodes} episodes.`,this.isSimulationComplete=!0,this.generateSimulationResults();return}this.resetAgent()}this.updateVisualization()}updateExplanation(t,r,e,o,l,p){let g=this.getStateKey(this.agent.x,this.agent.y),c=this.qTable[g][t].toFixed(2),h=`Episode ${this.agent.episode+1}, Step ${this.agent.step}: `;r?h+=`EXPLORING: Randomly chose action "${t}". `:h+=`EXPLOITING: Chose best action "${t}" with Q-value ${c}. `,h+=`Moved to position (${e}, ${o}) and received reward ${l}. `,h+=`TD Error: ${p.toFixed(4)}. `,this.grid[e][o].type==="goal"?h+="Reached the goal! Starting new episode.":this.grid[e][o].type==="pitfall"&&(h+="Fell into a pitfall! Starting new episode."),this.currentExplanation=h}toggleAutoplay(){this.isAutoPlaying?this.stopAutoplay():this.startAutoplay()}startAutoplay(){this.isRunning=!0,this.isAutoPlaying=!0,this.ngZone.runOutsideAngular(()=>{this.timerId=setInterval(()=>{this.ngZone.run(()=>{this.step(),this.updateRewardChart(),this.updateTDErrorChart()})},this.speed/this.playbackSpeed)})}stopAutoplay(){this.isAutoPlaying=!1,this.timerId&&(clearInterval(this.timerId),this.timerId=null)}startSimulation(){this.isRunning||(this.isRunning=!0,this.currentExplanation="Simulation started. The agent is learning...")}stopSimulation(){this.isRunning=!1,this.stopAutoplay(),this.currentExplanation="Simulation paused. Press Play to continue."}resetSimulation(){this.stopSimulation(),this.initializeQTable(),this.resetAgent(),this.agent.episode=0,this.epsilon=.3,this.episodeRewards=[],this.tdErrors=[],this.isSimulationComplete=!1,this.simulationResults="",this.updateVisualization(),this.updateRewardChart(),this.updateTDErrorChart(),this.currentExplanation="Simulation reset. Press Play to start learning."}changeSpeed(t){this.playbackSpeed=t,this.isAutoPlaying&&(this.stopAutoplay(),this.startAutoplay())}manualStep(){this.isRunning||this.startSimulation(),this.step(),this.updateRewardChart(),this.updateTDErrorChart()}initializeVisualization(){let t=this.gridSize*this.cellSize,r=this.gridSize*this.cellSize;this.svg=O(this.gridContainer.nativeElement).append("svg").attr("width",t).attr("height",r).style("background","#162a4a");for(let e=0;e<this.gridSize;e++)for(let o=0;o<this.gridSize;o++){let l=this.grid[e][o],p="#1e3a66";switch(l.type){case"wall":p="#0c1428";break;case"goal":p="#24b47e";break;case"pitfall":p="#ff6b6b";break}this.svg.append("rect").attr("x",e*this.cellSize).attr("y",o*this.cellSize).attr("width",this.cellSize).attr("height",this.cellSize).attr("fill",p).attr("stroke","#2a4980").attr("stroke-width",1).attr("rx",8).attr("ry",8).on("mouseover",g=>{if(l.type!=="wall"){let c=this.getStateKey(e,o),h=this.qTable[c],m=`<div><strong>Position: (${e}, ${o})</strong></div>`;m+=`<div>Type: ${l.type}</div>`,m+=`<div>Reward: ${l.reward}</div>`,m+='<div class="q-values">Q-Values:</div>',m+=`<div>\u2191 Up: ${h?.up?.toFixed(2)||"N/A"}</div>`,m+=`<div>\u2193 Down: ${h?.down?.toFixed(2)||"N/A"}</div>`,m+=`<div>\u2190 Left: ${h?.left?.toFixed(2)||"N/A"}</div>`,m+=`<div>\u2192 Right: ${h?.right?.toFixed(2)||"N/A"}</div>`,this.tooltipDiv.transition().duration(200).style("opacity",.9),this.tooltipDiv.html(m).style("left",g.pageX+10+"px").style("top",g.pageY-28+"px")}}).on("mouseout",()=>{this.tooltipDiv.transition().duration(500).style("opacity",0)}),this.svg.append("text").attr("x",e*this.cellSize+5).attr("y",o*this.cellSize+15).attr("font-size","10px").attr("fill","#8a9ab0").text(`(${e},${o})`),l.type!=="empty"&&l.type!=="wall"&&this.svg.append("text").attr("x",e*this.cellSize+this.cellSize/2).attr("y",o*this.cellSize+this.cellSize/2+5).attr("text-anchor","middle").attr("font-size","12px").attr("fill","#e1e7f5").text(`R: ${l.reward}`),l.type==="goal"?this.svg.append("text").attr("x",e*this.cellSize+this.cellSize/2).attr("y",o*this.cellSize+this.cellSize/2-5).attr("text-anchor","middle").attr("font-size","16px").attr("fill","#e1e7f5").text("\u{1F3AF}"):l.type==="pitfall"&&this.svg.append("text").attr("x",e*this.cellSize+this.cellSize/2).attr("y",o*this.cellSize+this.cellSize/2-5).attr("text-anchor","middle").attr("font-size","16px").attr("fill","#e1e7f5").text("\u26A0\uFE0F")}this.agentElement=this.svg.append("circle").attr("cx",this.agent.x*this.cellSize+this.cellSize/2).attr("cy",this.agent.y*this.cellSize+this.cellSize/2).attr("r",this.cellSize/3).attr("fill","#4285f4").attr("stroke","#ffffff").attr("stroke-width",2),this.updateQValueArrows()}updateQValueArrows(){this.svg.selectAll(".q-arrow").remove();for(let t=0;t<this.gridSize;t++)for(let r=0;r<this.gridSize;r++)if(this.grid[t][r].type!=="wall"){let e=this.getStateKey(t,r),o=this.qTable[e];if(!o)continue;let l=["up","down","left","right"],p=l[0],g=o[p];if(l.forEach(c=>{o[c]>g&&(g=o[c],p=c)}),g>0){let c=t*this.cellSize+this.cellSize/2,h=r*this.cellSize+this.cellSize/2,m=Math.min(Math.abs(g)/10,1)*(this.cellSize/3),d=0,f=0;switch(p){case"up":f=-m;break;case"down":f=m;break;case"left":d=-m;break;case"right":d=m;break}let u=c+d,s=h+f;this.svg.append("line").attr("class","q-arrow").attr("x1",c).attr("y1",h).attr("x2",u).attr("y2",s).attr("stroke","#00c9ff").attr("stroke-width",2).attr("marker-end","url(#arrowhead)"),this.svg.select("defs").node()||this.svg.append("defs").append("marker").attr("id","arrowhead").attr("markerWidth",10).attr("markerHeight",7).attr("refX",10).attr("refY",3.5).attr("orient","auto").append("polygon").attr("points","0 0, 10 3.5, 0 7").attr("fill","#00c9ff")}}}initializeQValueVisualization(){this.qValueSvg=O(this.qValueChart.nativeElement).append("svg").attr("width",300).attr("height",200).style("background","#162a4a").style("border-radius","12px"),this.qValueSvg.append("text").attr("x",300/2).attr("y",20).attr("text-anchor","middle").attr("fill","#e1e7f5").text("Q-Values for Current State")}initializeRewardChart(){let t={top:20,right:20,bottom:40,left:50},r=400,e=200,o=r-t.left-t.right,l=e-t.top-t.bottom;this.rewardChartSvg=O(this.rewardChart.nativeElement).append("svg").attr("width",r).attr("height",e).style("background","#162a4a").style("border-radius","12px").append("g").attr("transform",`translate(${t.left},${t.top})`),this.rewardChartSvg.append("text").attr("x",o/2).attr("y",-5).attr("text-anchor","middle").attr("fill","#e1e7f5").text("Total Reward per Episode"),this.rewardChartSvg.append("g").attr("class","x-axis").attr("transform",`translate(0,${l})`).call(M(_().range([0,o]))).style("color","#8a9ab0"),this.rewardChartSvg.append("g").attr("class","y-axis").call(P(_().range([l,0]))).style("color","#8a9ab0"),this.rewardChartSvg.append("text").attr("x",o/2).attr("y",l+35).attr("text-anchor","middle").attr("fill","#8a9ab0").text("Episode"),this.rewardChartSvg.append("text").attr("transform","rotate(-90)").attr("x",-l/2).attr("y",-30).attr("text-anchor","middle").attr("fill","#8a9ab0").text("Total Reward")}initializeTDErrorChart(){let t={top:20,right:20,bottom:40,left:50},r=400,e=200,o=r-t.left-t.right,l=e-t.top-t.bottom;this.tdErrorChartSvg=O(this.tdErrorChart.nativeElement).append("svg").attr("width",r).attr("height",e).style("background","#162a4a").style("border-radius","12px").append("g").attr("transform",`translate(${t.left},${t.top})`),this.tdErrorChartSvg.append("text").attr("x",o/2).attr("y",-5).attr("text-anchor","middle").attr("fill","#e1e7f5").text("TD Error Over Time"),this.tdErrorChartSvg.append("g").attr("class","x-axis").attr("transform",`translate(0,${l})`).call(M(_().range([0,o]))).style("color","#8a9ab0"),this.tdErrorChartSvg.append("g").attr("class","y-axis").call(P(_().range([l,0]))).style("color","#8a9ab0"),this.tdErrorChartSvg.append("text").attr("x",o/2).attr("y",l+35).attr("text-anchor","middle").attr("fill","#8a9ab0").text("Step"),this.tdErrorChartSvg.append("text").attr("transform","rotate(-90)").attr("x",-l/2).attr("y",-30).attr("text-anchor","middle").attr("fill","#8a9ab0").text("TD Error")}createTooltip(){this.tooltipDiv=O("body").append("div").attr("class","tooltip").style("opacity",0).style("position","absolute").style("background-color","#162a4a").style("color","#e1e7f5").style("border","1px solid #2a4980").style("border-radius","8px").style("padding","10px").style("pointer-events","none").style("z-index","10")}updateVisualization(){this.agentElement.transition().duration(200).attr("cx",this.agent.x*this.cellSize+this.cellSize/2).attr("cy",this.agent.y*this.cellSize+this.cellSize/2).attr("fill",this.agent.isExploring?"#ff9d45":"#4285f4"),this.agent.isExploring&&this.svg.append("circle").attr("cx",this.agent.x*this.cellSize+this.cellSize/2).attr("cy",this.agent.y*this.cellSize+this.cellSize/2).attr("r",this.cellSize/3).attr("fill","none").attr("stroke","#ff9d45").attr("stroke-width",3).attr("opacity",1).transition().duration(500).attr("r",this.cellSize/2).attr("opacity",0).remove(),this.updateQValueArrows(),this.updateQValueChart()}updateQValueChart(){let e={top:30,right:20,bottom:30,left:20},o=300-e.left-e.right,l=200-e.top-e.bottom;this.qValueSvg.selectAll(".q-chart-content").remove();let p=this.getStateKey(this.agent.x,this.agent.y),g=this.qTable[p];if(!g)return;let c=this.qValueSvg.append("g").attr("class","q-chart-content").attr("transform",`translate(${e.left},${e.top})`),h=["up","down","left","right"],m=h.map(s=>({action:s,value:g[s]})),d=Math.max(Math.abs(Z(m,s=>s.value)||0),Math.abs(Y(m,s=>s.value)||0),.1),f=j().domain(h).range([0,o]).padding(.3),u=_().domain([-d,d]).range([l,0]);c.append("g").attr("transform",`translate(0,${u(0)})`).call(M(f)).style("color","#8a9ab0"),c.append("g").call(P(u).ticks(5)).style("color","#8a9ab0"),c.selectAll(".bar").data(m).enter().append("rect").attr("class","bar").attr("x",s=>f(s.action)||0).attr("width",f.bandwidth()).attr("y",s=>s.value>=0?u(s.value):u(0)).attr("height",s=>Math.abs(u(s.value)-u(0))).attr("fill",s=>s.value>0?"#00c9ff":"#ff6b6b"),c.selectAll(".value-label").data(m).enter().append("text").attr("class","value-label").attr("x",s=>(f(s.action)||0)+f.bandwidth()/2).attr("y",s=>s.value>=0?u(s.value)-5:u(s.value)+15).attr("text-anchor","middle").attr("fill","#e1e7f5").attr("font-size","10px").text(s=>s.value.toFixed(2)),this.agent.lastAction&&c.append("rect").attr("x",f(this.agent.lastAction)||0).attr("y",0).attr("width",f.bandwidth()).attr("height",l).attr("fill","none").attr("stroke","#7c4dff").attr("stroke-width",2).attr("stroke-dasharray","3,3")}updateRewardChart(){if(this.episodeRewards.length===0)return;let t=400,r=200,e={top:20,right:20,bottom:40,left:50},o=t-e.left-e.right,l=r-e.top-e.bottom,p=_().domain([0,this.episodeRewards.length]).range([0,o]),g=Math.min(...this.episodeRewards),c=Math.max(...this.episodeRewards),h=Math.abs(c-g)*.1,m=_().domain([g-h,c+h]).range([l,0]);this.rewardChartSvg.select(".x-axis").call(M(p)).style("color","#8a9ab0"),this.rewardChartSvg.select(".y-axis").call(P(m)).style("color","#8a9ab0"),this.rewardChartSvg.selectAll(".reward-line").remove(),this.rewardChartSvg.selectAll(".reward-area").remove(),this.rewardChartSvg.selectAll(".reward-point").remove();let d=F().x((u,s)=>p(s)).y(u=>m(u)).curve(T),f=J().x((u,s)=>p(s)).y0(l).y1(u=>m(u)).curve(T);if(this.rewardChartSvg.append("path").datum(this.episodeRewards).attr("class","reward-area").attr("fill","url(#reward-gradient)").attr("d",f),!this.rewardChartSvg.select("#reward-gradient").node()){let u=this.rewardChartSvg.append("defs").append("linearGradient").attr("id","reward-gradient").attr("gradientUnits","userSpaceOnUse").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",l);u.append("stop").attr("offset","0%").attr("stop-color","#7c4dff").attr("stop-opacity",.8),u.append("stop").attr("offset","100%").attr("stop-color","#7c4dff").attr("stop-opacity",.1)}this.rewardChartSvg.append("path").datum(this.episodeRewards).attr("class","reward-line").attr("fill","none").attr("stroke","#7c4dff").attr("stroke-width",2).attr("d",d),this.rewardChartSvg.selectAll(".reward-point").data(this.episodeRewards).enter().append("circle").attr("class","reward-point").attr("cx",(u,s)=>p(s)).attr("cy",u=>m(u)).attr("r",3).attr("fill","#00c9ff")}updateTDErrorChart(){if(this.tdErrors.length===0)return;let t=this.tdErrors.slice(-100),r=400,e=200,o={top:20,right:20,bottom:40,left:50},l=r-o.left-o.right,p=e-o.top-o.bottom,g=_().domain([Math.max(0,this.tdErrors.length-100),this.tdErrors.length]).range([0,l]),c=Math.min(...t),h=Math.max(...t),m=Math.abs(h-c)*.1,d=_().domain([c-m,h+m]).range([p,0]);this.tdErrorChartSvg.select(".x-axis").call(M(g)).style("color","#8a9ab0"),this.tdErrorChartSvg.select(".y-axis").call(P(d)).style("color","#8a9ab0"),this.tdErrorChartSvg.selectAll(".td-error-line").remove();let f=F().x((u,s)=>g(this.tdErrors.length-t.length+s)).y(u=>d(u)).curve(T);this.tdErrorChartSvg.append("path").datum(t).attr("class","td-error-line").attr("fill","none").attr("stroke","#ff9d45").attr("stroke-width",2).attr("d",f)}static \u0275fac=function(r){return new(r||z)(K(B))};static \u0275cmp=W({type:z,selectors:[["app-q-learning-simulation"]],viewQuery:function(r,e){if(r&1&&(R(et,5),R(it,5),R(nt,5),R(at,5)),r&2){let o;V(o=A())&&(e.gridContainer=o.first),V(o=A())&&(e.qValueChart=o.first),V(o=A())&&(e.rewardChart=o.first),V(o=A())&&(e.tdErrorChart=o.first)}},decls:218,vars:29,consts:[["gridContainer",""],["qValueChart",""],["rewardChart",""],["tdErrorChart",""],[1,"q-learning-container"],[1,"header"],[1,"algorithm-category"],[1,"badge","reinforcement"],[1,"description"],[1,"simulation-controls"],[1,"control-group"],[1,"btn","primary",3,"click","disabled"],[1,"icon"],[1,"btn","secondary",3,"click","disabled"],[1,"btn","secondary",3,"click"],[1,"btn","primary",3,"click"],[1,"speed-control"],[1,"btn","mini",3,"click"],[1,"simulation-layout"],[1,"main-section"],[1,"grid-section"],[1,"grid-legend"],[1,"legend-item"],[1,"legend-color","empty"],[1,"legend-color","wall"],[1,"legend-color","goal"],[1,"legend-color","pitfall"],[1,"legend-color","agent"],[1,"legend-color","exploring"],[1,"grid-container"],[1,"info-section"],[1,"agent-info"],[1,"info-grid"],[1,"info-item"],[1,"info-item","exploration-mode"],[1,"q-value-visualization"],[1,"q-value-chart"],[1,"charts-section"],[1,"chart"],[1,"reward-chart"],[1,"td-error-chart"],[1,"explanation-section"],[1,"explanation-content"],[1,"current-explanation"],["class","results-summary",4,"ngIf"],[1,"algorithm-details"],[1,"detail-item"],[1,"formula"],[1,"results-summary"],["readonly","",1,"results-text"],[1,"btn","secondary","copy-btn",3,"click"]],template:function(r,e){if(r&1){let o=D();a(0,"div",4)(1,"div",5)(2,"h1"),n(3,"Q-Learning Algorithm Visualization"),i(),a(4,"div",6)(5,"span",7),n(6,"Reinforcement Learning"),i()()(),a(7,"div",8)(8,"p"),n(9,'Q-learning is a model-free, off-policy reinforcement learning algorithm that learns the value of an action in a particular state. The "Q" represents the "quality" of an action taken in a state.'),i()(),a(10,"div",9)(11,"div",10)(12,"button",11),S("click",function(){return v(o),y(e.startSimulation())}),a(13,"span",12),n(14,"\u25B6"),i(),n(15," Start "),i(),a(16,"button",13),S("click",function(){return v(o),y(e.stopSimulation())}),a(17,"span",12),n(18,"\u23F8"),i(),n(19," Pause "),i(),a(20,"button",14),S("click",function(){return v(o),y(e.resetSimulation())}),a(21,"span",12),n(22,"\u21BA"),i(),n(23," Reset "),i()(),a(24,"div",10)(25,"button",15),S("click",function(){return v(o),y(e.toggleAutoplay())}),a(26,"span",12),n(27),i(),n(28),i(),a(29,"button",13),S("click",function(){return v(o),y(e.manualStep())}),a(30,"span",12),n(31,"\u23EF"),i(),n(32," Step "),i()(),a(33,"div",10)(34,"div",16)(35,"label"),n(36,"Speed:"),i(),a(37,"button",17),S("click",function(){return v(o),y(e.changeSpeed(.5))}),n(38,"0.5x"),i(),a(39,"button",17),S("click",function(){return v(o),y(e.changeSpeed(1))}),n(40,"1x"),i(),a(41,"button",17),S("click",function(){return v(o),y(e.changeSpeed(2))}),n(42,"2x"),i(),a(43,"button",17),S("click",function(){return v(o),y(e.changeSpeed(5))}),n(44,"5x"),i()()()(),a(45,"div",18)(46,"div",19)(47,"div",20)(48,"h2"),n(49,"Environment Grid"),i(),a(50,"div",21)(51,"div",22),C(52,"div",23),a(53,"span"),n(54,"Empty Cell (-1)"),i()(),a(55,"div",22),C(56,"div",24),a(57,"span"),n(58,"Wall"),i()(),a(59,"div",22),C(60,"div",25),a(61,"span"),n(62,"Goal (+100)"),i()(),a(63,"div",22),C(64,"div",26),a(65,"span"),n(66,"Pitfall (-50)"),i()(),a(67,"div",22),C(68,"div",27),a(69,"span"),n(70,"Agent"),i()(),a(71,"div",22),C(72,"div",28),a(73,"span"),n(74,"Exploring"),i()()(),C(75,"div",29,0),i(),a(77,"div",30)(78,"div",31)(79,"h2"),n(80,"Agent Status"),i(),a(81,"div",32)(82,"div",33)(83,"label"),n(84,"Episode:"),i(),a(85,"span"),n(86),i()(),a(87,"div",33)(88,"label"),n(89,"Step:"),i(),a(90,"span"),n(91),i()(),a(92,"div",33)(93,"label"),n(94,"Position:"),i(),a(95,"span"),n(96),i()(),a(97,"div",33)(98,"label"),n(99,"Total Reward:"),i(),a(100,"span"),n(101),i()(),a(102,"div",33)(103,"label"),n(104,"\u03B5 (Exploration):"),i(),a(105,"span"),n(106),i()(),a(107,"div",33)(108,"label"),n(109,"\u03B1 (Learning Rate):"),i(),a(110,"span"),n(111),i()(),a(112,"div",33)(113,"label"),n(114,"\u03B3 (Discount):"),i(),a(115,"span"),n(116),i()(),a(117,"div",34)(118,"label"),n(119,"Mode:"),i(),a(120,"span"),n(121),i()()()(),a(122,"div",35)(123,"h2"),n(124,"Q-Values"),i(),C(125,"div",36,1),i()()(),a(127,"div",37)(128,"div",38)(129,"h2"),n(130,"Reward Progress"),i(),C(131,"div",39,2),i(),a(133,"div",38)(134,"h2"),n(135,"TD Error"),i(),C(136,"div",40,3),i()(),a(138,"div",41)(139,"h2"),n(140,"Algorithm Explanation"),i(),a(141,"div",42)(142,"h3"),n(143,"Current State"),i(),a(144,"div",43)(145,"p"),n(146),i()(),G(147,rt,9,1,"div",44),a(148,"div",45)(149,"h3"),n(150,"Q-Learning Key Concepts"),i(),a(151,"div",46)(152,"h4"),n(153,"Temporal Difference (TD) Learning"),i(),a(154,"p"),n(155,"Q-learning uses TD updates where the value estimate is updated based on the observed reward and the estimated value of the next state."),i()(),a(156,"div",46)(157,"h4"),n(158,"Update Formula"),i(),a(159,"div",47),n(160," Q(s, a) \u2190 Q(s, a) + \u03B1 [r + \u03B3 max"),a(161,"sub"),n(162,"a'"),i(),n(163," Q(s', a') - Q(s, a)] "),i(),a(164,"p"),n(165,"Where:"),i(),a(166,"ul")(167,"li")(168,"strong"),n(169,"Q(s, a)"),i(),n(170,": Current estimate of action-value"),i(),a(171,"li")(172,"strong"),n(173,"\u03B1"),i(),n(174,": Learning rate (How quickly to update values)"),i(),a(175,"li")(176,"strong"),n(177,"r"),i(),n(178,": Immediate reward"),i(),a(179,"li")(180,"strong"),n(181,"\u03B3"),i(),n(182,": Discount factor (Value of future rewards)"),i(),a(183,"li")(184,"strong"),n(185,"s'"),i(),n(186,": Next state"),i(),a(187,"li")(188,"strong"),n(189,"a'"),i(),n(190,": Possible actions in next state"),i(),a(191,"li")(192,"strong"),n(193,"max"),a(194,"sub"),n(195,"a'"),i(),n(196," Q(s', a')"),i(),n(197,": Maximum Q-value in next state"),i()()(),a(198,"div",46)(199,"h4"),n(200,"Exploration vs. Exploitation"),i(),a(201,"p"),n(202,"The agent balances exploration (trying new actions) with exploitation (choosing best known actions) using an epsilon-greedy strategy:"),i(),a(203,"ul")(204,"li"),n(205,"With probability "),a(206,"strong"),n(207,"\u03B5"),i(),n(208,", choose a random action (explore)"),i(),a(209,"li"),n(210,"With probability "),a(211,"strong"),n(212,"1-\u03B5"),i(),n(213,", choose the best action (exploit)"),i(),a(214,"li")(215,"strong"),n(216,"\u03B5"),i(),n(217," decreases over time to favor exploitation as the agent learns"),i()()()()()()()()}r&2&&(x(12),k("disabled",e.isRunning),x(4),k("disabled",!e.isRunning),x(9),E("active",e.isAutoPlaying),x(2),w(e.isAutoPlaying?"\u23F8":"\u25B6"),x(),H(" ",e.isAutoPlaying?"Stop Auto":"Auto Play"," "),x(),k("disabled",e.isAutoPlaying),x(8),E("active",e.playbackSpeed===.5),x(2),E("active",e.playbackSpeed===1),x(2),E("active",e.playbackSpeed===2),x(2),E("active",e.playbackSpeed===5),x(43),$("",e.agent.episode+1,"/",e.maxEpisodes,""),x(5),w(e.agent.step),x(5),$("(",e.agent.x,", ",e.agent.y,")"),x(5),w(e.agent.totalReward.toFixed(2)),x(5),w(e.epsilon.toFixed(3)),x(5),w(e.learningRate.toFixed(2)),x(5),w(e.discountFactor.toFixed(2)),x(),E("exploring",e.agent.isExploring),x(4),w(e.agent.isExploring?"Exploring (Random)":"Exploiting (Greedy)"),x(25),w(e.currentExplanation),x(),k("ngIf",e.isSimulationComplete))},dependencies:[U,X],styles:["*[_ngcontent-%COMP%]{box-sizing:border-box;margin:0;padding:0}body[_ngcontent-%COMP%]{font-family:Inter,Roboto,sans-serif;background-color:#0c1428;color:#e1e7f5;line-height:1.6}.q-learning-container[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:24px;background-color:#0c1428}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid #1e3a66}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:#fff;margin:0}.header[_ngcontent-%COMP%]   .algorithm-category[_ngcontent-%COMP%]{display:flex;gap:8px}.header[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:8px 16px;border-radius:20px;font-size:14px;font-weight:600}.header[_ngcontent-%COMP%]   .badge.reinforcement[_ngcontent-%COMP%]{background-color:#ff9d4533;color:#ff9d45;border:1px solid #ff9d45}.description[_ngcontent-%COMP%]{margin-bottom:24px}.description[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#8a9ab0;max-width:900px}.simulation-controls[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;margin-bottom:24px;padding:16px;background-color:#162a4a;border-radius:12px}.simulation-controls[_ngcontent-%COMP%]   .control-group[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.simulation-controls[_ngcontent-%COMP%]   .speed-control[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.simulation-controls[_ngcontent-%COMP%]   .speed-control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;color:#8a9ab0}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;border:none;display:flex;align-items:center;gap:8px;transition:all .2s ease}.btn.primary[_ngcontent-%COMP%]{background-color:#4285f4;color:#fff}.btn.primary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2c5cbd}.btn.primary.active[_ngcontent-%COMP%]{background-color:#2c5cbd;box-shadow:0 0 0 2px #4285f480}.btn.secondary[_ngcontent-%COMP%]{background-color:#1e3a66;color:#e1e7f5}.btn.secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2a4980}.btn.mini[_ngcontent-%COMP%]{padding:4px 8px;font-size:12px}.btn.mini.active[_ngcontent-%COMP%]{background-color:#4285f4;color:#fff}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:12px}.simulation-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:24px}.main-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px}@media (max-width: 1200px){.main-section[_ngcontent-%COMP%]{grid-template-columns:1fr}}.grid-section[_ngcontent-%COMP%]{background-color:#162a4a;border-radius:12px;padding:24px;box-shadow:0 4px 6px #0000001a}.grid-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;margin-bottom:16px;color:#fff}.grid-legend[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;margin-bottom:16px}.grid-legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:12px}.grid-legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]   .legend-color[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:4px}.grid-legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]   .legend-color.empty[_ngcontent-%COMP%]{background-color:#1e3a66}.grid-legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]   .legend-color.wall[_ngcontent-%COMP%]{background-color:#0c1428}.grid-legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]   .legend-color.goal[_ngcontent-%COMP%]{background-color:#24b47e}.grid-legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]   .legend-color.pitfall[_ngcontent-%COMP%]{background-color:#ff6b6b}.grid-legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]   .legend-color.agent[_ngcontent-%COMP%]{background-color:#4285f4}.grid-legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]   .legend-color.exploring[_ngcontent-%COMP%]{background-color:#ff9d45}.grid-container[_ngcontent-%COMP%]{display:flex;justify-content:center}.grid-container[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 4px 10px #0003}.info-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.agent-info[_ngcontent-%COMP%]{background-color:#162a4a;border-radius:12px;padding:24px;box-shadow:0 4px 6px #0000001a}.agent-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;margin-bottom:16px;color:#fff}.agent-info[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:16px}.agent-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.agent-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:12px;color:#8a9ab0}.agent-info[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:16px;font-weight:600}.agent-info[_ngcontent-%COMP%]   .info-item.exploration-mode[_ngcontent-%COMP%]{grid-column:1/-1;padding:8px;border-radius:8px;background-color:#4285f41a}.agent-info[_ngcontent-%COMP%]   .info-item.exploration-mode.exploring[_ngcontent-%COMP%]{background-color:#ff9d451a}.agent-info[_ngcontent-%COMP%]   .info-item.exploration-mode.exploring[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#ff9d45}.q-value-visualization[_ngcontent-%COMP%]{background-color:#162a4a;border-radius:12px;padding:24px;box-shadow:0 4px 6px #0000001a}.q-value-visualization[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;margin-bottom:16px;color:#fff}.charts-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px}@media (max-width: 900px){.charts-section[_ngcontent-%COMP%]{grid-template-columns:1fr}}.charts-section[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]{background-color:#162a4a;border-radius:12px;padding:24px;box-shadow:0 4px 6px #0000001a}.charts-section[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;margin-bottom:16px;color:#fff}.explanation-section[_ngcontent-%COMP%]{background-color:#162a4a;border-radius:12px;padding:24px;box-shadow:0 4px 6px #0000001a}.explanation-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;margin-bottom:16px;color:#fff}.explanation-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;margin-bottom:12px;color:#fff}.explanation-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:16px;margin-bottom:8px;color:#fff}.explanation-section[_ngcontent-%COMP%]   .current-explanation[_ngcontent-%COMP%]{background-color:#1e3a66;border-radius:8px;padding:16px;margin-bottom:24px;border-left:4px solid #00c9ff}.explanation-section[_ngcontent-%COMP%]   .current-explanation[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;line-height:1.6}.explanation-section[_ngcontent-%COMP%]   .results-summary[_ngcontent-%COMP%]{background-color:#1e3a66;border-radius:8px;padding:16px;margin-bottom:24px;border-left:4px solid #7c4dff}.explanation-section[_ngcontent-%COMP%]   .results-summary[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#7c4dff;margin-bottom:12px}.explanation-section[_ngcontent-%COMP%]   .results-summary[_ngcontent-%COMP%]   .results-text[_ngcontent-%COMP%]{width:100%;min-height:200px;background-color:#0c1428;color:#e1e7f5;border:1px solid #2a4980;border-radius:8px;padding:12px;font-family:monospace;resize:vertical;margin-bottom:12px;line-height:1.5}.explanation-section[_ngcontent-%COMP%]   .results-summary[_ngcontent-%COMP%]   .copy-btn[_ngcontent-%COMP%]{background-color:#1e3a66;border:1px solid #2a4980}.explanation-section[_ngcontent-%COMP%]   .results-summary[_ngcontent-%COMP%]   .copy-btn[_ngcontent-%COMP%]:hover{background-color:#2a4980}.explanation-section[_ngcontent-%COMP%]   .algorithm-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.explanation-section[_ngcontent-%COMP%]   .algorithm-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]{border-bottom:1px solid #1e3a66;padding-bottom:16px}.explanation-section[_ngcontent-%COMP%]   .algorithm-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.explanation-section[_ngcontent-%COMP%]   .algorithm-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;margin-bottom:12px;line-height:1.6}.explanation-section[_ngcontent-%COMP%]   .algorithm-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   .formula[_ngcontent-%COMP%]{background-color:#1e3a66;padding:12px;border-radius:8px;font-family:monospace;margin-bottom:12px;text-align:center;font-size:16px}.explanation-section[_ngcontent-%COMP%]   .algorithm-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:24px}.explanation-section[_ngcontent-%COMP%]   .algorithm-details[_ngcontent-%COMP%]   .detail-item[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:14px;margin-bottom:4px}[_nghost-%COMP%]     .tooltip{font-size:12px;line-height:1.4}[_nghost-%COMP%]     .tooltip strong{color:#fff;display:block;margin-bottom:4px}[_nghost-%COMP%]     .tooltip .q-values{margin-top:8px;font-weight:600;color:#00c9ff}@media (max-width: 768px){.q-learning-container[_ngcontent-%COMP%]{padding:16px}.header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}.simulation-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.agent-info[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}"]})};export{tt as QLearningSimulationComponent};
